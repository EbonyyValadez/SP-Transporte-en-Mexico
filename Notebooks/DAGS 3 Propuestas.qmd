---
title: "DAGs propuestas"
format: 
    html:
     toc: true
     html-math-method: katex
     embed-resources: true
     self-contained-math: true
     df-print: kable
editor: source
---

## DAGs propuestas

```{r}
#| eval: false
install.packages("bnlearn")
```
```{r}
library(bnlearn)
```
```{r}
set.seed(1234)
data=read.csv("~/SP-Transporte-en-Mexico/data_corregido.csv", stringsAsFactors = TRUE)
head(data)
```
```{r}
data$S   = factor(data$S)     # sexo
data$A   = factor(data$A)     # edad_cat
data$EST = factor(data$EST)   # estrato
data$T   = factor(data$T)     # transporte
data$D   = factor(data$D)     # dia_viaje

data$O   = factor(data$O)     # entidad
data$L   = factor(data$L)     # localidad

data$H   = factor(data$H)     # tiempo_cat
data$V   = factor(data$V)     # autos_camionetas
data$ESC = factor(data$ESC)   # escolaridad
```

Para el manejo de la DAG se asignó una clave corta a cada variable:
    A = edad_cat,
    D = dia_viaje,
    EST = estrato,
    V = autos_camionetas,
    L = localidad,
    H = tiempo_cat,     
    O = Entidad,        
    ESC = escolaridad,
    S = sexo,
    T = transporte

La DAG 1 se formula con base en que la edad determina la educación y ésta se relaciona con el estrato sociodemográfico de la perosna y el tipo de transporte que utiliza, así como arcos en función de cuestiones geográficas y el tiempo de traslado, así como quizá el sexo interfiera con el medio de transporte.
```{r}
dag1 = empty.graph(nodes = c("A", "D", "EST", "V", "L", "H", "O", "ESC","S","T"))
```
```{r}
arc_set1 = matrix(c("A","ESC",
                   "ESC","EST",
                   "EST","V",
                   "V","T",
                   "T","H",
                   "S","T",
                   "D","T",
                   "O","L",
                   "L","EST",
                   "L","H"), 
                 byrow = TRUE, ncol = 2,
                 dimnames = list(NULL, c("from","to")))
```
```{r}
arcs(dag1) = arc_set1
```
```{r}
dag1
```
```{r}
graphviz.plot(dag1, shape = "rectangle")
```

```{r}
bn_mle=bn.fit(dag1,data=data, method='mle')
arc.strength(dag1, data = data, criterion = "mi")
```



```{r}
arc.strength(dag1, data = data, criterion = "mi")
```

```{r}
score(dag1, data = data, type = "bic")
```
```{r}
score(dag1, data = data, type = "aic")
```

La segunda DAG propuesta se centra principalmente en el entorno geográfico, es decir, que del lugar de origen o la localidad se relacionan el estrato, el tiempo del viaje, la cantidad de vehículos, así como otras relaciones entre el sexo y la edad para determinar la escolaridad y el medio de transporte.
```{r}
dag2 = empty.graph(nodes = c("A", "D", "EST", "V", "L", "H", "O", "ESC","S","T"))
```

```{r}
arc_set2 = matrix(c("O","L",
                   "L","EST",
                   "EST","T",
                   "O","H",
                   "L","H",
                   "EST","V",
                   "V","T",
                   "S","T",
                   "A","ESC",
                   "ESC","T",
                   "D","H"), 
                 byrow = TRUE, ncol = 2,
                 dimnames = list(NULL, c("from","to")))
```
```{r}
arcs(dag2) = arc_set2
```
```{r}
dag2
```
```{r}
graphviz.plot(dag2, shape = "rectangle")
```
```{r}
arc.strength(dag2, data = data, criterion = "mi")
```

```{r}
score(dag2, data = data, type = "bic")
```
```{r}
score(dag2, data = data, type = "aic")

```

Por último, la tercera DAG se basa principalmente en factores personales como los determinantes de mayor impacto. Teniendo como nodos padres e independientes la edad y el sexo, y que a partir de éstos se condicionen otros aspectos relacionados con la movilidad de las personas, su escolaridad y el estrato en el que se encuentran.

```{r}
dag3 = empty.graph(nodes = c("A", "D", "EST", "V", "L", "H", "O", "ESC","S","T"))
```
```{r}
arc_set3 = matrix(c("A","ESC",
                   "ESC","EST",
                   "EST","T",
                   "T","H",
                   "S","T",
                   "A","V",
                   "V","T",
                   "O","L",
                   "L","T",
                   "D","T",
                   "L","H"), 
                 byrow = TRUE, ncol = 2,
                 dimnames = list(NULL, c("from","to")))
```
```{r}
arcs(dag3) = arc_set3
```
```{r}
dag3
arc.strength(dag3, data = data, criterion = "mi")
```
```{r}
graphviz.plot(dag3, shape = "rectangle")
```
```{r}
score(dag3, data = data, type = "bic")
```
```{r}
score(dag3, data = data, type = "aic")
dim(data)

```
Con base en los puntajes de la prueba BIC, aquella que tenía el mayor de éstas y en función de la librería bnlearn, se selecciona como mejor la primera DAG de las 3 propuestas.





